<!DOCTYPE html>
<html>
  <head>
    <script>
      function I(name) {
        return document.getElementById(name);
      }

      function capture() {
        I('canvas').getContext('2d').drawImage(player, 0, 0, I('canvas').width, I('canvas').height);
      }

      var intervalHandle = null;

      function openCamera() {
        const constraints = { 
          video: { facingMode: "environment", width: 4096, height: 4096, frameRate: 1 }
        };
        navigator.mediaDevices.getUserMedia(constraints)
          .then(stream => {
            const s = stream.getVideoTracks()[0].getSettings();
            I('resolutionP').innerText = `Camera resolution is ${s.width} x ${s.height} @ ${s.frameRate}fps`;
            I('canvas').width = s.width;
            I('canvas').height = s.height;
            I('player').srcObject = stream;
          });
          intervalHandle = window.setInterval(capture, 1000);
      }

      function closeCamera() {
        if (intervalHandle) {
          I('player').srcObject.getVideoTracks().forEach(track => track.stop());
          window.clearInterval(intervalHandle);
          intervalHandle = null;
        }
      }
    </script>
  </head>
  <body>
    <button id="openCameraButton" onclick="openCamera()">Open Camera</button>
    <button id="closeCameraButton" onclick="closeCamera()">Close Camera</button>
    <p id="resolutionP"></p>
    <video id="player" controls autoplay style="width:400px; display:none"></video>
    <canvas id="canvas" width=320 height=240 style="width:400px"></canvas>
  </body>
</html>
